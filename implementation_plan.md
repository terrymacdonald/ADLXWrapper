# Implementation Plan

## Overview
The overall goal is to build unit tests for the ADLXWrapper project using xUnit.net, targeting .NET 8.0. This implementation is needed to ensure the core functionality of the C# wrapper for the AMD ADLX SDK DLL, including system, GPU, and display management, works as expected and to prevent regressions. The tests will focus on verifying the correct interaction with the ADLX native library through the generated C# bindings, and also ensure that the generated C# binding objects are correctly serializable and deserializable using Newtonsoft.Json.

## Types
No new custom types will be defined for the unit tests. Existing types from the `ADLXWrapper` namespace, which are generated by SWIG, will be utilized to interact with the ADLX SDK. Additionally, the plan will ensure that these generated types are compatible with Newtonsoft.Json for serialization and deserialization.

## Files
The following files will be created or modified:
- **New directory:** `ADLXWrapper.Tests/` - This will house the new unit test project.
- **New file:** `ADLXWrapper.Tests/ADLXWrapper.Tests.csproj` - The xUnit.net project file for the unit tests, targeting .NET 8.0 and referencing `ADLXWrapper.csproj`.
- **New file:** `ADLXWrapper.Tests/SystemServicesTests.cs` - This file will contain unit tests for the `IADLXSystem` and `IADLXSystemServices` interfaces, focusing on initialization, termination, and querying system interfaces.
- **New file:** `ADLXWrapper.Tests/GpuServicesTests.cs` - This file will contain unit tests for the `IADLXGPU` and `IADLXGPUServices` interfaces, focusing on GPU enumeration and querying GPU interfaces.
- **New file:** `ADLXWrapper.Tests/DisplayServicesTests.cs` - This file will contain unit tests for the `IADLXDisplay` and `IADLXDisplayServices` interfaces, focusing on display enumeration, resolution, and other basic display properties.
- **New file:** `ADLXWrapper.Tests/SerializationTests.cs` - This file will contain unit tests to verify JSON serialization and deserialization of key `ADLXWrapper` objects using Newtonsoft.Json.
- **Modified file:** `ADLXWrapper.sln` - The solution file will be updated to include the new `ADLXWrapper.Tests` project.

## Functions
The unit tests will primarily call existing functions exposed by the `ADLXWrapper` C# bindings. No new functions will be added to the core `ADLXWrapper` project. The test files will contain test methods (functions) for verifying the functionality.

- **New functions (test methods) in `SystemServicesTests.cs`:**
    - `InitializeAndTerminateADLX_ShouldReturnSuccess()`: Tests the `ADLXHelper.Initialize()` and `ADLXHelper.Terminate()` methods.
    - `QuerySystemServices_ShouldReturnValidInterface()`: Tests obtaining the `IADLXSystemServices` interface.
    - `QuerySystem1Interface_ShouldReturnValidInterface()`: Tests querying for `IADLXSystem1`.
    - `QuerySystem2Interface_ShouldReturnValidInterface()`: Tests querying for `IADLXSystem2`.

- **New functions (test methods) in `GpuServicesTests.cs`:**
    - `EnumerateGPUs_ShouldReturnAtLeastOneGPU()`: Tests enumerating available GPUs.
    - `QueryGPU1Interface_ShouldReturnValidInterface()`: Tests querying for `IADLXGPU1`.
    - `QueryGPU2Interface_ShouldReturnValidInterface()`: Tests querying for `IADLXGPU2`.

- **New functions (test methods) in `DisplayServicesTests.cs`:**
    - `QueryDisplayServices_ShouldReturnValidInterface()`: Tests obtaining the `IADLXDisplayServices` interface.
    - `EnumerateDisplays_ShouldReturnAtLeastOneDisplay()`: Tests enumerating connected displays.
    - `GetDisplayResolution_ShouldReturnValidResolution()`: Tests retrieving display resolution.
    - `GetDisplayRefreshRate_ShouldReturnValidRefreshRate()`: Tests retrieving display refresh rate.

- **New functions (test methods) in `SerializationTests.cs`:**
    - `ADLXObject_CanSerializeAndDeserializeToJson()`: Generic test to serialize and deserialize a representative ADLX object.
    - Specific tests for various ADLX data structures (e.g., `ADLX_Point`, `ADLX_RGB`, `ADLX_TimingInfo`) to ensure they can be serialized and deserialized correctly.

## Classes
- **New class:** `SystemServicesTests` in `ADLXWrapper.Tests/SystemServicesTests.cs` - This class will contain unit tests related to ADLX system services.
- **New class:** `GpuServicesTests` in `ADLXWrapper.Tests/GpuServicesTests.cs` - This class will contain unit tests related to ADLX GPU services.
- **New class:** `DisplayServicesTests` in `ADLXWrapper.Tests/DisplayServicesTests.cs` - This class will contain unit tests related to ADLX display services.
- **New class:** `SerializationTests` in `ADLXWrapper.Tests/SerializationTests.cs` - This class will contain unit tests for JSON serialization/deserialization.

## Dependencies
- **New package dependency:** `xunit` (latest stable version) will be added to `ADLXWrapper.Tests.csproj`.
- **New package dependency:** `xunit.runner.visualstudio` (latest stable version) will be added to `ADLXWrapper.Tests.csproj`.
- **New package dependency:** `Newtonsoft.Json` (latest stable version) will be added to `ADLXWrapper.Tests.csproj`.
- **Project reference:** `ADLXWrapper.Tests.csproj` will reference `ADLXWrapper.csproj`.

## Testing
The testing approach will involve creating unit tests using xUnit.net. These tests will:
- Initialize the ADLX library.
- Obtain various ADLX interfaces (System, GPU, Display, etc.).
- Call methods on these interfaces to verify expected behavior and return values.
- Terminate the ADLX library.
- For serialization tests, instances of ADLX data structures will be created, serialized to JSON, deserialized back into objects, and then compared to the original objects to ensure data integrity.
- Assertions will be used to confirm successful operations, valid interface retrieval, and correct serialization/deserialization.
- The tests will be run using `dotnet test` command.

## Implementation Order
1. Create the `ADLXWrapper.Tests` project and add necessary package references (`xunit`, `xunit.runner.visualstudio`, `Newtonsoft.Json`).
2. Add the `ADLXWrapper.Tests` project to the `ADLXWrapper.sln` solution file.
3. Implement `SystemServicesTests.cs` with tests for ADLX initialization, termination, and system interface queries.
4. Implement `GpuServicesTests.cs` with tests for GPU enumeration and GPU interface queries.
5. Implement `DisplayServicesTests.cs` with tests for display enumeration and display property queries.
6. Implement `SerializationTests.cs` with tests for JSON serialization and deserialization of key ADLXWrapper objects.
7. Run all unit tests to verify functionality.
